<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dynamic SOAP JSON Parser</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background: #f4f6f8; }
  textarea { width: 100%; height: 200px; font-family: monospace; padding: 10px; }
  button { margin-top: 10px; padding: 10px 15px; cursor: pointer; }
  pre { background: #1e1e1e; color: #dcdcdc; padding: 15px; overflow: auto; max-height: 500px; white-space: pre-wrap; word-wrap: break-word; }
  .error { color: red; margin-top: 10px; }
</style>
</head>
<body>

<h2>Dynamic SOAP JSON Parser</h2>

<textarea id="input" placeholder="Paste SOAP response here..."></textarea>
<br>
<button onclick="convert()">Convert</button>

<pre id="output"></pre>
<div class="error" id="error"></div>

<script>
// Recursively parses any JSON string, dynamic for unknown structures
function deepParse(value) {
  if (typeof value === "string") {
    const trimmed = value.trim();
    if ((trimmed.startsWith("{") && trimmed.endsWith("}")) ||
        (trimmed.startsWith("[") && trimmed.endsWith("]"))) {
      try {
        return deepParse(JSON.parse(trimmed)); // recursive parse
      } catch {
        return value; // keep original if not valid JSON
      }
    }
    return value;
  }

  if (Array.isArray(value)) {
    return value.map(deepParse); // recurse arrays
  }

  if (value !== null && typeof value === "object") {
    const result = {};
    for (const key in value) {
      result[key] = deepParse(value[key]); // recurse objects
    }
    return result;
  }

  return value; // numbers, booleans, null
}

function convert() {
  const input = document.getElementById("input").value;
  const output = document.getElementById("output");
  const error = document.getElementById("error");

  output.textContent = "";
  error.textContent = "";

  try {
    // Step 1: Parse outer JSON
    let outer = JSON.parse(input);

    // Step 2: If 'd' exists and is a string, parse it
    let data = outer.d && typeof outer.d === "string" ? JSON.parse(outer.d) : outer;

    // Step 3: Deep parse all nested JSON dynamically
    const parsed = deepParse(data);

    // Step 4: Pretty print
    output.textContent = JSON.stringify(parsed, null, 2);

  } catch (e) {
    error.textContent = "Parsing error: " + e.message;
  }
}
</script>

</body>
</html>
